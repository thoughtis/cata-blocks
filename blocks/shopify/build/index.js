(()=>{"use strict";var e,t={321:(e,t,a)=>{const o=window.wp.blocks,r=window.wp.blockEditor,i=window.wp.element,n=window.wp.components,s=window.wp.data,c=window.wp.apiFetch;var l=a.n(c);const p=window.wp.compose,u=window.ReactJSXRuntime;function d({value:e,onDebouncedChange:t,timeout:a,...o}){const[r,s]=(0,i.useState)(e),[c,l]=(0,i.useState)(e),d=(0,p.useDebounce)(l,a);return(0,i.useEffect)((()=>{c!==r&&d(r)}),[c,r]),(0,i.useEffect)((()=>{t(c)}),[c]),(0,u.jsx)(n.TextControl,{value:r,onChange:s,...o})}function h({image:e,aspect_ratio:t}){const a=function(e,t,a=[]){return(0===a.length?[e]:a).filter(m.bind(null,e)).map(b.bind(null,t))}(e.width,t,[2560,1920,1280,960,640,480,320]).map(f.bind(null,e.url)),o={aspectRatio:t};return(0,u.jsx)("figure",{className:"wp-block-cata-shopify-product__image",children:(0,u.jsx)("img",{loading:"lazy",src:e.url,alt:e.altText,sizes:"(max-width: 576px) 92.5vw, 576px",srcSet:a,width:e.width,height:e.height,style:o})})}function f(e,t){const a=new URL(e);return a.searchParams.set("width",t[0]),a.searchParams.set("height",t[1]),a.searchParams.set("crop","center"),`${a.href.toString()} ${t[0]}w`}function m(e,t){return t<=e}function b(e,t){let a=t;return 2===(e=e.split("/")).length&&0!==e[0]&&0!==e[1]&&(a=Math.round(t/(e[0]/e[1]))),[t,a]}function w({price:e}){const t=parseFloat(e.maxVariantPrice.amount).toFixed(2),a=parseFloat(e.minVariantPrice.amount).toFixed(2);return e=t!==a?"$"+a+" - $"+t:"$"+a,(0,u.jsx)("div",{className:"wp-block-cata-shopify-product__price",children:(0,u.jsx)("span",{children:e})})}function x({product:e,display_price:t,aspect_ratio:a}){return(0,u.jsx)("article",{className:"wp-block-cata-shopify-product",children:(0,u.jsxs)("div",{className:"wp-block-cata-shopify-product__layout",children:[(0,u.jsx)("div",{className:"wp-block-cata-shopify-product__start",children:e.featuredImage&&(0,u.jsx)(h,{image:e.featuredImage,aspect_ratio:a})}),(0,u.jsxs)("div",{className:"wp-block-cata-shopify-product__end",children:[(0,u.jsx)("h3",{className:"wp-block-cata-shopify-product__title",children:(0,u.jsx)("a",{className:"wp-block-cata-shopify-product__link",href:e.onlineStoreUrl,children:e.title})}),t&&(0,u.jsx)(w,{price:e.priceRange})]})]})})}function g({products:e,display_price:t,aspect_ratio:a}){return 0===e.length?(0,u.jsx)("p",{children:"No products, update the options to try again."}):(0,u.jsx)("div",{className:"wp-block-cata-shopify__layout",children:e.map(((e,o)=>(0,u.jsx)(x,{product:e,display_price:t,aspect_ratio:a},`cata-blocks-shopify-product-${o}`)))})}(0,o.registerBlockType)("cata/shopify",{edit:function({attributes:e,setAttributes:t}){const{store:a,count:o,tags:c,display_price:p,aspect_ratio:h}=e,f=(0,s.useSelect)((e=>e("cata/blocks").getShopifyData()),[]),[m,b]=(0,i.useState)([]);function w(e){b([]),console.error(e)}return(0,i.useEffect)((function(){""!==a?l()({path:"/cata/v1/shopify-proxy",method:"POST",data:{...e}}).then((e=>{b(e.flat())})).catch(w):b([])}),[a,o,c]),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{...(0,r.useBlockProps)(),children:(0,u.jsx)(g,{products:m,display_price:p,aspect_ratio:h})}),(0,u.jsxs)(r.InspectorControls,{children:[(0,u.jsx)(n.PanelBody,{title:"Store",initialOpen:!1,children:(0,u.jsx)(n.PanelRow,{children:(0,u.jsx)(n.SelectControl,{label:"Store",value:a,onChange:e=>{t({store:e})},options:[{value:"",label:"Select a store..."},...f.map((e=>({value:e,label:e})))]})})}),(0,u.jsxs)(n.PanelBody,{title:"Product Selection",initialOpen:!1,children:[(0,u.jsx)(d,{label:"Product Tag Names",onDebouncedChange:e=>t({tags:e}),timeout:300,type:"text",value:c,help:"Enter multiple tag names in a comma separated list."}),(0,u.jsx)(n.TextControl,{label:"Number of Products",onChange:e=>t({count:e}),type:"number",value:o})]}),(0,u.jsxs)(n.PanelBody,{title:"Product Block Options",initialOpen:!0,children:[(0,u.jsx)(n.SelectControl,{label:"Image Aspect Ratio",value:h,onChange:e=>{t({aspect_ratio:e})},options:[{label:"Square - 1:1",value:"1/1"},{label:"Portrait - 3:4",value:"3/4"},{label:"Landscape - 3:2",value:"3/2"}]}),(0,u.jsx)(n.ToggleControl,{label:"Display product price",help:p?"Product price shown.":"No product price.",checked:p,onChange:e=>{t({display_price:e})}})]})]})]})},save:function(){return(0,u.jsx)("div",{...r.useBlockProps.save()})}}),(0,o.registerBlockStyle)("cata/shopify",{name:"reel",label:"Reel"}),(0,o.registerBlockStyle)("cata/shopify",{name:"list",label:"List"})}},a={};function o(e){var r=a[e];if(void 0!==r)return r.exports;var i=a[e]={exports:{}};return t[e](i,i.exports,o),i.exports}o.m=t,e=[],o.O=(t,a,r,i)=>{if(!a){var n=1/0;for(p=0;p<e.length;p++){for(var[a,r,i]=e[p],s=!0,c=0;c<a.length;c++)(!1&i||n>=i)&&Object.keys(o.O).every((e=>o.O[e](a[c])))?a.splice(c--,1):(s=!1,i<n&&(n=i));if(s){e.splice(p--,1);var l=r();void 0!==l&&(t=l)}}return t}i=i||0;for(var p=e.length;p>0&&e[p-1][2]>i;p--)e[p]=e[p-1];e[p]=[a,r,i]},o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};o.O.j=t=>0===e[t];var t=(t,a)=>{var r,i,[n,s,c]=a,l=0;if(n.some((t=>0!==e[t]))){for(r in s)o.o(s,r)&&(o.m[r]=s[r]);if(c)var p=c(o)}for(t&&t(a);l<n.length;l++)i=n[l],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(p)},a=globalThis.webpackChunk=globalThis.webpackChunk||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var r=o.O(void 0,[350],(()=>o(321)));r=o.O(r)})();