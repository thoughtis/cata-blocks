!function(){var e={739:function(){}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var l=t[r]={exports:{}};return e[r](l,l.exports,n),l.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";var e=window.wp.blocks,t=window.wp.element,r=window.wp.i18n,a=window.wp.blockEditor,l=window.wp.components,i=window.wp.apiFetch,s=n.n(i);function o(e){let{text:n}=e;const r=document.createRange().createContextualFragment(n).firstChild.textContent;return(0,t.createElement)(t.Fragment,null,r)}function c(e){let{post:n}=e;return(0,t.createElement)("p",null,(0,t.createElement)("a",{href:n.link},(0,t.createElement)(o,{text:n.title.rendered})))}function m(e,t){const n=new URL(e);return n.searchParams.set("resize",t.join(",")),`${n.href.toString()} ${t[0]}w`}function u(e){let{data:n,sizes:r,dimensions:a,className:l}=e;if(!("source_url"in n))return null;const i=new URL(n.source_url);i.searchParams.set("resize",a[0].join(","));const s=a.map(m.bind(null,n.source_url));return(0,t.createElement)("img",{width:a[0][0],height:a[0][1],src:i.href.toString(),sizes:r,srcSet:s.join(","),className:l,loading:"lazy"})}function d(e,t){return t<=e}function f(e,t){return[t,Math.round(t/e)]}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(null===e)return[];const{width:r,height:a}=e.media_details,l=null===t?r/a:t,i=(0===n.length?[r]:n).filter(d.bind(null,r));return i.map(f.bind(null,l))}function w(e){if(!("_embedded"in e)||!("wp:featuredmedia"in e._embedded))return null;if(!Array.isArray(e._embedded["wp:featuredmedia"])||0===e._embedded["wp:featuredmedia"].length)return null;const t=e._embedded["wp:featuredmedia"].filter((e=>"media_type"in e&&"image"===e.media_type));return 0===t.length?null:t.shift()}const E=["uncategorized","collective-world","project-oasis"];function h(e){if(!("_embedded"in e)||!("wp:term"in e._embedded))return null;if(!Array.isArray(e._embedded["wp:term"])||0===e._embedded["wp:term"].length)return null;const t=e._embedded["wp:term"].filter(_);if(0===t.length)return null;const n=t[0].filter((e=>!E.includes(e.slug)));return 0===n.length?null:Object.assign({},n[0])}function _(e){return Array.isArray(e)&&0<e.length&&"taxonomy"in e[0]&&"category"===e[0].taxonomy}function g(e){if(!("_embedded"in e)||!("wp:term"in e._embedded))return null;if(!Array.isArray(e._embedded["wp:term"])||0===e._embedded["wp:term"].length)return null;const t=e._embedded["wp:term"].filter(v);return 0===t.length?null:Object.assign({},t[0][0].profile)}function v(e){return Array.isArray(e)&&0<e.length&&"taxonomy"in e[0]&&"author"===e[0].taxonomy}function y(e){let{author:n}=e;const r=0<n.media.length?n.media[0]:null,a=p(r,1,[320,160,80]);return(0,t.createElement)("p",{className:"preview__byline"},null!==r&&(0,t.createElement)(u,{data:r,sizes:"6em",dimensions:a,className:"preview__avatar"}),(0,t.createElement)("a",{rel:"author",href:n.link},(0,t.createElement)("em",null,(0,t.createElement)(o,{text:n.display_name}))))}function b(e){let{post:n}=e;const r=w(n),a=p(r,1.5,[2560,1920,1280,960,640,480,320]),l=h(n),i=g(n);return(0,t.createElement)("article",{className:"preview is-layout-trending"},null!==r&&(0,t.createElement)("figure",{className:"preview__image-container"},(0,t.createElement)("a",{rel:"bookmark",href:n.link},(0,t.createElement)(u,{data:r,dimensions:a,sizes:"(max-width: 15em) 92.5vw, 15em"}))),(0,t.createElement)("div",{className:"preview__content"},null!==l&&(0,t.createElement)("p",{className:"preview__kicker has-step-n-2-font-size"},(0,t.createElement)("a",{rel:"category",href:l.link},(0,t.createElement)("strong",null,(0,t.createElement)(o,{text:l.name})))),(0,t.createElement)("h3",{className:"preview__title has-step-4-font-size"},(0,t.createElement)("a",{rel:"bookmark",href:n.link},(0,t.createElement)(o,{text:n.title.rendered}))),null!==i&&(0,t.createElement)(y,{author:i})))}function k(e){let{post:n}=e;const r=w(n),a=p(r,.8,[2560,1920,1280,960,640,480,320]),l=h(n),i=g(n);return(0,t.createElement)("article",{className:"preview is-layout-trending"},null!==r&&(0,t.createElement)("figure",{className:"preview__image-container"},(0,t.createElement)("a",{rel:"bookmark",href:n.link},(0,t.createElement)(u,{data:r,dimensions:a,sizes:"(max-width: 20em) 92.5vw, 20em"}))),(0,t.createElement)("div",{className:"preview__content"},null!==l&&(0,t.createElement)("p",{className:"preview__kicker has-step-n-2-font-size"},(0,t.createElement)("a",{rel:"category",href:l.link},(0,t.createElement)(o,{text:l.name}))),(0,t.createElement)("h3",{className:"preview__title has-step-4-font-size"},(0,t.createElement)("a",{rel:"bookmark",href:n.link},(0,t.createElement)(o,{text:n.title.rendered}))),null!==i&&(0,t.createElement)(y,{author:i})))}function N(){return 0}function x(e,t){return Math.sign(Date.parse(t.date_gmt)-Date.parse(e.date_gmt))}function P(e){return"published:newest"===e?x:N}function R(e){let{posts:n,sorting:r}=e;if(2>=n.length)return null;const a=n.slice();return""!==r&&a.sort(P(r)),(0,t.createElement)("div",{className:"wp-block-cata-rest__layout is-layout-trending"},(0,t.createElement)("div",{className:"has-serif-font-family"},(0,t.createElement)(b,{post:a[0]})),(0,t.createElement)("div",{className:"has-serif-font-family"},(0,t.createElement)(k,{post:a[1]})),(0,t.createElement)("div",{className:"has-sans-serif-font-family"},(0,t.createElement)("div",{className:"wp-block-cata-rest__list has-step-p-0-font-size line-height-2"},a.slice(2,8).map((e=>(0,t.createElement)(c,{key:e.id,post:e}))))))}function z(e){let{post:n}=e;const r=w(n),a=p(r);return(0,t.createElement)("article",{className:"preview is-layout-network"},(0,t.createElement)("div",{className:"preview__layout"},(0,t.createElement)("div",{className:"preview__start"},null!==r&&(0,t.createElement)("figure",{className:"preview__image-container"},(0,t.createElement)("a",{rel:"bookmark",href:n.link},(0,t.createElement)(u,{data:r,dimensions:a,sizes:"(max-width: 40em) 92.5vw, 36em"})))),(0,t.createElement)("div",{className:"preview__end"},(0,t.createElement)("h3",{className:"preview__title has-step-5-font-size has-sans-serif-font-family"},(0,t.createElement)("a",{rel:"bookmark",className:"preview__permalink",href:n.link},(0,t.createElement)(o,{text:n.title.rendered}))),(0,t.createElement)("div",{className:"preview__excerpt has-sans-serif-font-family"},(0,t.createElement)(t.RawHTML,null,n.excerpt.rendered)),(0,t.createElement)("p",{className:"preview__domain has-step-n-1-font-size has-serif-font-family"},new URL(n.link).hostname))))}function A(e){let{posts:n,sorting:r}=e;if(0===n.length)return null;const a=n.slice();return""!==r&&a.sort(P(r)),(0,t.createElement)("div",{className:"wp-block-cata-rest__layout is-layout-network"},a.map((e=>(0,t.createElement)(z,{key:e.id,post:e}))))}var C=n(739);s().use(C.proxyMiddleware),s().use(C.cacheMiddleware),(0,e.registerBlockType)("cata/rest",{edit:function(e){let{attributes:n,setAttributes:i,clientId:o}=e;const{urls:c,content:m,layout:u,sorting:d}=n,[f,p]=(0,t.useState)(""),[w,E]=(0,t.useState)([]);function h(e){return s()({path:e,cata:{useCache:!0,useProxy:!0},signal:(new AbortController).signal})}function _(e){console.error(e)}return(0,t.useEffect)((function(){Promise.all(c.map(h)).then((e=>{E(e.flat())})).catch(_)}),[c]),(0,t.useEffect)((function(){const e="network"===u?A:R;i({...n,content:(0,t.createElement)(e,{posts:w,sorting:d})})}),[w,u,d]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",(0,a.useBlockProps)(),m),(0,t.createElement)(a.InspectorControls,null,(0,t.createElement)(l.PanelBody,{title:"WP REST API URLs",initialOpen:!1},(0,t.createElement)(l.PanelRow,null,(0,t.createElement)("div",null,c.map(((e,n)=>(0,t.createElement)("div",{key:`${o}-cata-rest-url-${n}`},(0,t.createElement)(l.Button,{text:"x",label:"Remove",variant:"tertiary",isDestructive:!0,onClick:()=>{i({urls:c.filter(((e,t)=>t!==n))})}}),e))))),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.TextControl,{label:(0,r.__)("WP REST API URL","thcatacatalog"),type:"url",value:f,onChange:p})),(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.Button,{variant:"primary",text:(0,r.__)("Add URL","thcatacatalog"),onClick:()=>{i({urls:[...c,f]}),p("")}}))),(0,t.createElement)(l.PanelBody,{title:"REST Layout",initialOpen:!1},(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.SelectControl,{label:"Layout",value:u,onChange:e=>{i({...n,layout:e})},options:[{label:"Default",value:""},{label:"Trending",value:"trending"},{label:"Network",value:"network"}]}))),(0,t.createElement)(l.PanelBody,{title:"REST Sorting",initialOpen:!1},(0,t.createElement)(l.PanelRow,null,(0,t.createElement)(l.SelectControl,{label:"Sorting",value:d,onChange:e=>{i({...n,sorting:e})},options:[{label:"Default",value:""},{label:"Newest First by Published Date",value:"published:newest"}]})))))},save:function(n){let{attributes:{content:r}}=n;return(0,t.createElement)("div",a.useBlockProps.save(),(0,t.createElement)(t.RawHTML,null,"string"==typeof r?r:e.children.toHTML([r])))}})}()}();