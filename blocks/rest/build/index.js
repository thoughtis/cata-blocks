!function(){"use strict";var e={n:function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,{a:n}),n},d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t=window.wp.blocks,n=window.wp.apiFetch,r=e.n(n),a=window.wp.element,l=window.wp.i18n,i=window.wp.blockEditor,s=window.wp.components;function c(e){let{text:t}=e;const n=document.createRange().createContextualFragment(t).firstChild.textContent;return(0,a.createElement)(a.Fragment,null,n)}function o(e){let{post:t}=e;return(0,a.createElement)("p",null,(0,a.createElement)("a",{href:t.link},(0,a.createElement)(c,{text:t.title.rendered})))}function m(e,t){const n=new URL(e);return n.searchParams.set("resize",t.join(",")),`${n.href.toString()} ${t[0]}w`}function u(e){let{data:t,sizes:n,dimensions:r,className:l}=e;if(!("source_url"in t))return null;const i=new URL(t.source_url);i.searchParams.set("resize",r[0].join(","));const s=r.map(m.bind(null,t.source_url));return(0,a.createElement)("img",{width:r[0][0],height:r[0][1],src:i.href.toString(),sizes:n,srcSet:s.join(","),className:l,loading:"lazy"})}function d(e,t){return t<=e}function f(e,t){return[t,Math.round(t/e)]}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(null===e)return[];const{width:r,height:a}=e.media_details,l=null===t?r/a:t,i=(0===n.length?[r]:n).filter(d.bind(null,r));return i.map(f.bind(null,l))}function E(e){if(!("_embedded"in e)||!("wp:featuredmedia"in e._embedded))return null;if(!Array.isArray(e._embedded["wp:featuredmedia"])||0===e._embedded["wp:featuredmedia"].length)return null;const t=e._embedded["wp:featuredmedia"].filter((e=>"media_type"in e&&"image"===e.media_type));return 0===t.length?null:t.shift()}const w=["uncategorized","collective-world","project-oasis"];function h(e){if(!("_embedded"in e)||!("wp:term"in e._embedded))return null;if(!Array.isArray(e._embedded["wp:term"])||0===e._embedded["wp:term"].length)return null;const t=e._embedded["wp:term"].filter(_);if(0===t.length)return null;const n=t[0].filter((e=>!w.includes(e.slug)));return 0===n.length?null:Object.assign({},n[0])}function _(e){return Array.isArray(e)&&0<e.length&&"taxonomy"in e[0]&&"category"===e[0].taxonomy}function g(e){if(!("_embedded"in e)||!("wp:term"in e._embedded))return null;if(!Array.isArray(e._embedded["wp:term"])||0===e._embedded["wp:term"].length)return null;const t=e._embedded["wp:term"].filter(v);return 0===t.length?null:Object.assign({},t[0][0].profile)}function v(e){return Array.isArray(e)&&0<e.length&&"taxonomy"in e[0]&&"author"===e[0].taxonomy}function y(e){let{author:t}=e;const n=0<t.media.length?t.media[0]:null,r=p(n,1,[320,160,80]);return(0,a.createElement)("p",{className:"preview__byline"},null!==n&&(0,a.createElement)(u,{data:n,sizes:"6em",dimensions:r,className:"preview__avatar"}),(0,a.createElement)("a",{rel:"author",href:t.link},(0,a.createElement)("em",null,(0,a.createElement)(c,{text:t.display_name}))))}function b(e){let{post:t}=e;const n=E(t),r=p(n,1.5,[2560,1920,1280,960,640,480,320]),l=h(t),i=g(t);return(0,a.createElement)("article",{className:"preview is-layout-trending"},null!==n&&(0,a.createElement)("figure",{className:"preview__image-container"},(0,a.createElement)("a",{rel:"bookmark",href:t.link},(0,a.createElement)(u,{data:n,dimensions:r,sizes:"(max-width: 15em) 92.5vw, 15em"}))),(0,a.createElement)("div",{className:"preview__content"},null!==l&&(0,a.createElement)("p",{className:"preview__kicker has-step-n-2-font-size"},(0,a.createElement)("a",{rel:"category",href:l.link},(0,a.createElement)("strong",null,(0,a.createElement)(c,{text:l.name})))),(0,a.createElement)("h3",{className:"preview__title has-step-4-font-size"},(0,a.createElement)("a",{rel:"bookmark",href:t.link},(0,a.createElement)(c,{text:t.title.rendered}))),null!==i&&(0,a.createElement)(y,{author:i})))}function k(e){let{post:t}=e;const n=E(t),r=p(n,.8,[2560,1920,1280,960,640,480,320]),l=h(t),i=g(t);return(0,a.createElement)("article",{className:"preview is-layout-trending"},null!==n&&(0,a.createElement)("figure",{className:"preview__image-container"},(0,a.createElement)("a",{rel:"bookmark",href:t.link},(0,a.createElement)(u,{data:n,dimensions:r,sizes:"(max-width: 20em) 92.5vw, 20em"}))),(0,a.createElement)("div",{className:"preview__content"},null!==l&&(0,a.createElement)("p",{className:"preview__kicker has-step-n-2-font-size"},(0,a.createElement)("a",{rel:"category",href:l.link},(0,a.createElement)(c,{text:l.name}))),(0,a.createElement)("h3",{className:"preview__title has-step-4-font-size"},(0,a.createElement)("a",{rel:"bookmark",href:t.link},(0,a.createElement)(c,{text:t.title.rendered}))),null!==i&&(0,a.createElement)(y,{author:i})))}function N(){return 0}function x(e,t){return Math.sign(Date.parse(t.date_gmt)-Date.parse(e.date_gmt))}function P(e){return"published:newest"===e?x:N}function z(e){let{posts:t,sorting:n}=e;if(2>=t.length)return null;const r=t.slice();return""!==n&&r.sort(P(n)),(0,a.createElement)("div",{className:"wp-block-cata-rest__layout is-layout-trending"},(0,a.createElement)("div",{className:"has-serif-font-family"},(0,a.createElement)(b,{post:r[0]})),(0,a.createElement)("div",{className:"has-serif-font-family"},(0,a.createElement)(k,{post:r[1]})),(0,a.createElement)("div",{className:"has-sans-serif-font-family"},(0,a.createElement)("div",{className:"wp-block-cata-rest__list has-step-p-0-font-size line-height-2"},r.slice(2,8).map((e=>(0,a.createElement)(o,{key:e.id,post:e}))))))}function R(e){let{post:t}=e;const n=E(t),r=p(n);return(0,a.createElement)("article",{className:"preview is-layout-network"},(0,a.createElement)("div",{className:"preview__layout"},(0,a.createElement)("div",{className:"preview__start"},null!==n&&(0,a.createElement)("figure",{className:"preview__image-container"},(0,a.createElement)("a",{rel:"bookmark",href:t.link},(0,a.createElement)(u,{data:n,dimensions:r,sizes:"(max-width: 40em) 92.5vw, 36em"})))),(0,a.createElement)("div",{className:"preview__end"},(0,a.createElement)("h3",{className:"preview__title has-step-5-font-size has-sans-serif-font-family"},(0,a.createElement)("a",{rel:"bookmark",className:"preview__permalink",href:t.link},(0,a.createElement)(c,{text:t.title.rendered}))),(0,a.createElement)("div",{className:"preview__excerpt has-sans-serif-font-family"},(0,a.createElement)(a.RawHTML,null,t.excerpt.rendered)),(0,a.createElement)("p",{className:"preview__domain has-step-n-1-font-size has-serif-font-family"},new URL(t.link).hostname))))}function A(e){let{posts:t,sorting:n}=e;if(0===t.length)return null;const r=t.slice();return""!==n&&r.sort(P(n)),(0,a.createElement)("div",{className:"wp-block-cata-rest__layout is-layout-network"},r.map((e=>(0,a.createElement)(R,{key:e.id,post:e}))))}(0,t.registerBlockType)("cata/rest",{edit:function(e){let{attributes:t,setAttributes:n,clientId:c}=e;const{urls:o,content:m,layout:u,sorting:d}=t,[f,p]=(0,a.useState)(""),[E,w]=(0,a.useState)([]);function h(e){return r()({path:e,cata:{useCache:!0,useProxy:!0},signal:(new AbortController).signal})}function _(e){console.error(e)}return(0,a.useEffect)((function(){Promise.all(o.map(h)).then((e=>{w(e.flat())})).catch(_)}),[o]),(0,a.useEffect)((function(){const e="network"===u?A:z;n({...t,content:(0,a.createElement)(e,{posts:E,sorting:d})})}),[E,u,d]),(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",(0,i.useBlockProps)(),m),(0,a.createElement)(i.InspectorControls,null,(0,a.createElement)(s.PanelBody,{title:"WP REST API URLs",initialOpen:!1},(0,a.createElement)(s.PanelRow,null,(0,a.createElement)("div",null,o.map(((e,t)=>(0,a.createElement)("div",{key:`${c}-cata-rest-url-${t}`},(0,a.createElement)(s.Button,{text:"x",label:"Remove",variant:"tertiary",isDestructive:!0,onClick:()=>{n({urls:o.filter(((e,n)=>n!==t))})}}),e))))),(0,a.createElement)(s.PanelRow,null,(0,a.createElement)(s.TextControl,{label:(0,l.__)("WP REST API URL","thcatacatalog"),type:"url",value:f,onChange:p})),(0,a.createElement)(s.PanelRow,null,(0,a.createElement)(s.Button,{variant:"primary",text:(0,l.__)("Add URL","thcatacatalog"),onClick:()=>{n({urls:[...o,f]}),p("")}}))),(0,a.createElement)(s.PanelBody,{title:"REST Sorting",initialOpen:!1},(0,a.createElement)(s.PanelRow,null,(0,a.createElement)(s.SelectControl,{label:"Sorting",value:d,onChange:e=>{n({...t,sorting:e})},options:[{label:"Default",value:""},{label:"Newest First by Published Date",value:"published:newest"}]})))))},save:function(e){let{attributes:{content:n}}=e;return(0,a.createElement)("div",i.useBlockProps.save(),(0,a.createElement)(a.RawHTML,null,"string"==typeof n?n:t.children.toHTML([n])))}})}();